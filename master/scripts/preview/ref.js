define(["../core/lib"],function(e){return{resolveJson:function(t,r){function i(h,u,_,v,g){var m,$,b=o in h?h[o]:_;void 0!==b&&(b=(a+b).replace(l,"$2$3"));var A=g||h;if(void 0!==b){if(f&&(h.__id=b),!r.schemas||h instanceof Array||!($=b.match(/^(.+\/)[^\.\[]*$/))||(v=r.schemas[$[1]]),s[b]&&h instanceof Array==s[b]instanceof Array)A=s[b],delete A.$ref,m=!0;else{var O=v&&v.prototype;O&&(y.prototype=O,A=new y)}s[b]=A,c&&(c[b]=r.time)}var j=v&&v.properties,P=h.length;for(var w in h){if(w==P)break;if(h.hasOwnProperty(w)){$=h[w];var D=j&&j[w];if(D&&"date-time"==D.format&&"string"==typeof $)$=e.fromISOString($);else if("object"==typeof $&&$&&!($ instanceof Date))if(n=$.$ref){delete h[w];var S=n.replace(/(#)([^\.\[])/,"$1.$2").match(/(^([^\[]*\/)?[^#\.\[]*)#?([\.\[].*)?/);if((n="$"==S[1]||"this"==S[1]||""==S[1]?t:s[(a+S[1]).replace(l,"$2$3")])&&S[3]&&S[3].replace(/(\[([^\]]+)\])|(\.?([^\.\[]+))/g,function(e,t,r,i,o){n=n&&n[r?r.replace(/[\"\'\\]/,""):o]}),n)$=n;else if(u)$=i($,!1,$.$ref,D),$._loadObject=r.loader;else{var I;I||d.push(A),I=!0}}else u||($=i($,d==h,b&&p(b,w),D,A!=h&&"object"==typeof A[w]&&A[w]));if(h[w]=$,A!=h&&!A.__isDirty){var U=A[w];A[w]=$,!m||$===U||A._loadObject||$ instanceof Date&&U instanceof Date&&$.getTime()==U.getTime()||"function"==typeof $&&"function"==typeof U&&$.toString()==U.toString()||!s.onUpdate||s.onUpdate(A,w,U,$)}}}if(m){for(w in A)if(!A.__isDirty&&A.hasOwnProperty(w)&&!h.hasOwnProperty(w)&&"__id"!=w&&"__clientId"!=w&&!(A instanceof Array&&isNaN(w)))for(s.onUpdate&&"_loadObject"!=w&&"_idAttr"!=w&&s.onUpdate(A,w,A[w],void 0),delete A[w];A instanceof Array&&A.length&&void 0===A[A.length-1];)A.length--}else s.onLoad&&s.onLoad(A);return A}r=r||{};var n,o=r.idAttribute||"id",a=r.idPrefix||"",f=r.assignAbsoluteIds,s=r.index||{},c=r.timeStamps,d=[],l=/^(.*\/)?(\w+:\/\/)|[^\/\.]+\/\.\.\/|^.*\/(\/)/,p=this._addProp,y=function(){};return t&&"object"==typeof t&&(t=i(t,!1,r.defaultId),i(d,!1)),t},_addProp:function(e,t){return e+(e.match(/#/)?1==e.length?"":".":"#")+t}}});
//# sourceMappingURL=ref.js.map